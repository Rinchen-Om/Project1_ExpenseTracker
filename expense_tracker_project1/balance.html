<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Balance Overview</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #ffe6e6;
      --text: #000;
      --card: #fff0f0;
      --green: #00c897;
      --red: #ff4d4d;
      --purple: #5b2be0;
      --header-bg: #2f5bba;
      --nav-text: white;
    }

    body.dark {
      --bg: #121212;
      --text: #ffffff;
      --card: #1e1e1e;
      --header-bg: #1a1a2e;
      --nav-text: #f8f8f8;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: var(--header-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 30px;
      height: 80px;
    }

    img {
      border-radius: 50%;
      max-width: 60px;
      max-height: 60px;
    }

    .page-title {
      font-size: 24px;
      font-weight: bold;
      margin-right: auto;
      margin-left: 20px;
      color: var(--nav-text);
    }

    nav a {
      margin-left: 20px;
      text-decoration: none;
      color: var(--nav-text);
      font-weight: bold;
      font-size: 16px;
    }

    nav a:hover {
      color: #ffcc00;
    }

    .main {
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .balance {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .positive {
      color: var(--green);
    }

    .negative {
      color: var(--red);
    }

    .neutral {
      color: var(--text);
    }

    .card {
      background: var(--card);
      border-radius: 20px;
      padding: 2rem;
      margin: 1rem 0;
      width: 90%;
      max-width: 900px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .chart-container {
      position: relative;
      width: 100%;
      height: 300px;
    }

    canvas {
      max-width: 100%;
    }

    .section-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      font-weight: bold;
    }

    .calendar, .transactions, .circle-graph {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .calendar table {
      width: 100%;
      border-spacing: 10px;
      color: var(--text);
    }

    .calendar td, .calendar th {
      text-align: center;
      padding: 0.6rem;
      border-radius: 10px;
    }

    .calendar td:hover {
      background-color: var(--purple);
      color: white;
      cursor: pointer;
    }

    .last-expense-item {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px solid #ccc;
    }

    .income { color: var(--green); }
    .expense { color: var(--red); }

 
    footer {
      background-color: #7f27c2;
      color: white;
      text-align: center;
      padding: 20px;
      width: 100%;
    }

    .footer-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .contact a, .follow-us a {
      color: #ffcc00;
      text-decoration: none;
      margin: 5px;
    }

    .contact a:hover, .follow-us a:hover {
      color: #ff6666;
    }

    @media (min-width: 768px) {
      .calendar, .transactions, .circle-graph {
        flex-wrap: nowrap;
        gap: 2rem;
      }
    }

    @media (max-width: 600px) {
      header {
        flex-direction: column;
        height: auto;
        padding: 10px;
      }
      
      nav {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      nav a {
        margin: 5px 10px;
      }
      
      .page-title {
        margin: 10px 0;
      }
    }
  </style>
</head>
<body>

  <header>
    <img src="New folder/logo.png" alt="Logo">
    <div class="page-title">Expense Tracker</div>
    <nav>
      <a href="home.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="income.html">Income</a>
      <a href="expense.html">Expense</a>
      <a href="balance.html">Balance</a>
    </nav>
  </header>

  
  <div class="main">
    <div class="balance" id="balanceDisplay">Nu. 0.00</div>

    <div class="card">
      <div class="chart-container">
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <div class="card calendar">
      <div>
        <div class="section-title">Monthly Overview</div>
        <table id="calendarTable">
          <!-- Calendar will be generated by JavaScript -->
        </table>
      </div>
      <div class="circle-graph">
        <div class="chart-container" style="height: 250px;">
          <canvas id="doughnutChart"></canvas>
        </div>
      </div>
    </div>

    <div class="card transactions">
      <div class="section-title">Recent Transactions</div>
      <div id="lastTransactions"></div>
    </div>
  </div>

  <footer>
    <div class="footer-container">
      <div class="location">
        üìç <strong>Location:</strong> <a href="https://mapcarta.com/34489982" target="_blank">CST College, Bhutan</a>
      </div>
      <div class="contact">
        üìß <strong>Email:</strong> <a href="mailto:example@mail.com">example@mail.com</a>
        üìû <strong>Phone:</strong> +91 1234567890
      </div>
      <div class="follow-us">
        <p>Follow Us:</p>
        <a href="https://www.facebook.com/ExpenseTracker" target="_blank">üìò Facebook</a>
        <a href="https://twitter.com/ExpenseTracker" target="_blank">üê¶ Twitter</a>
        <a href="https://www.instagram.com/ExpenseTracker" target="_blank">üì∑ Instagram</a>
        <a href="https://www.linkedin.com/company/ExpenseTracker" target="_blank">üíº LinkedIn</a>
      </div>
      <p>¬© 2025 Expense Tracker | All Rights Reserved</p>
    </div>
  </footer>

  <script>
    // Global variables
    let lineChart, doughnutChart;
    const monthNames = ["January", "February", "March", "April", "May", "June", 
                       "July", "August", "September", "October", "November", "December"];
    const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    
    // Initialize dark mode from localStorage
    function initDarkMode() {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark');
      }
    }

    // Load data from localStorage
    function loadFinancialData() {
      const incomeData = JSON.parse(localStorage.getItem("incomeData")) || [];
      const expenseData = JSON.parse(localStorage.getItem("expenseData")) || [];
      
      return {
        incomeData,
        expenseData,
        totalIncome: incomeData.reduce((sum, item) => sum + Number(item.amount), 0),
        totalExpense: expenseData.reduce((sum, item) => sum + Number(item.amount), 0)
      };
    }

    // Update balance display
    function updateBalanceDisplay(balance) {
      const balanceElement = document.getElementById("balanceDisplay");
      balanceElement.textContent = `Nu. ${balance.toFixed(2)}`;
      
      if (balance > 0) {
        balanceElement.className = "balance positive";
      } else if (balance < 0) {
        balanceElement.className = "balance negative";
      } else {
        balanceElement.className = "balance neutral";
      }
    }

    // Generate calendar
    function generateCalendar() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      const calendarTable = document.getElementById("calendarTable");
      calendarTable.innerHTML = '';
      
      // Create header row with day names
      let headerRow = document.createElement("tr");
      dayNames.forEach(day => {
        const th = document.createElement("th");
        th.textContent = day[0]; // Just show first letter
        headerRow.appendChild(th);
      });
      calendarTable.appendChild(headerRow);
      
      // Create calendar cells
      let date = 1;
      for (let i = 0; i < 6; i++) {
        if (date > daysInMonth) break;
        
        const row = document.createElement("tr");
        for (let j = 0; j < 7; j++) {
          const cell = document.createElement("td");
          if (i === 0 && j < firstDay) {
            cell.textContent = "";
          } else if (date > daysInMonth) {
            cell.textContent = "";
          } else {
            cell.textContent = date;
            if (date === now.getDate()) {
              cell.style.backgroundColor = "#5b2be0";
              cell.style.color = "white";
            }
            date++;
          }
          row.appendChild(cell);
        }
        calendarTable.appendChild(row);
      }
    }

    // Create line chart
    function createLineChart(incomeData, expenseData) {
      const ctx = document.getElementById('lineChart').getContext('2d');
      
      // Group data by month
      const monthlyIncome = Array(12).fill(0);
      const monthlyExpense = Array(12).fill(0);
      
      incomeData.forEach(item => {
        const date = new Date(item.datetime || new Date());
        monthlyIncome[date.getMonth()] += Number(item.amount);
      });
      
      expenseData.forEach(item => {
        const date = new Date(item.date || new Date());
        monthlyExpense[date.getMonth()] += Number(item.amount);
      });
      
      lineChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: monthNames,
          datasets: [
            {
              label: 'Income',
              data: monthlyIncome,
              borderColor: '#00c897',
              backgroundColor: 'rgba(0, 200, 151, 0.1)',
              fill: true,
              tension: 0.4
            },
            {
              label: 'Expenses',
              data: monthlyExpense,
              borderColor: '#ff4d4d',
              backgroundColor: 'rgba(255, 77, 77, 0.1)',
              fill: true,
              tension: 0.4
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { 
              position: 'top',
              labels: {
                color: getComputedStyle(document.body).getPropertyValue('--text')
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: Nu. ${context.raw.toFixed(2)}`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(200, 200, 200, 0.1)'
              },
              ticks: {
                color: getComputedStyle(document.body).getPropertyValue('--text')
              }
            },
            y: {
              grid: {
                color: 'rgba(200, 200, 200, 0.1)'
              },
              ticks: {
                color: getComputedStyle(document.body).getPropertyValue('--text'),
                callback: function(value) {
                  return 'Nu. ' + value;
                }
              }
            }
          }
        }
      });
    }

    // Create doughnut chart
    function createDoughnutChart(totalIncome, totalExpense) {
      const ctx = document.getElementById('doughnutChart').getContext('2d');
      
      doughnutChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Income', 'Expenses'],
          datasets: [{
            data: [totalIncome, totalExpense],
            backgroundColor: ['#00c897', '#ff4d4d'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: getComputedStyle(document.body).getPropertyValue('--text')
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.label}: Nu. ${context.raw.toFixed(2)}`;
                }
              }
            }
          }
        }
      });
    }

    // Update chart colors when mode changes
    function updateChartColors() {
      if (lineChart) {
        lineChart.options.scales.x.ticks.color = getComputedStyle(document.body).getPropertyValue('--text');
        lineChart.options.scales.y.ticks.color = getComputedStyle(document.body).getPropertyValue('--text');
        lineChart.options.plugins.legend.labels.color = getComputedStyle(document.body).getPropertyValue('--text');
        lineChart.update();
      }
      
      if (doughnutChart) {
        doughnutChart.options.plugins.legend.labels.color = getComputedStyle(document.body).getPropertyValue('--text');
        doughnutChart.update();
      }
    }

    // Display recent transactions
    function displayRecentTransactions(incomeData, expenseData) {
      // Combine and sort all transactions by date
      const allTransactions = [
        ...incomeData.map(item => ({
          type: 'income',
          amount: item.amount,
          source: item.source || 'Income',
          date: item.datetime || new Date().toISOString(),
          notes: item.notes || ''
        })),
        ...expenseData.map(item => ({
          type: 'expense',
          amount: item.amount,
          source: item.category || 'Expense',
          date: item.date || new Date().toISOString(),
          notes: item.name || ''
        }))
      ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
      
      const container = document.getElementById("lastTransactions");
      container.innerHTML = '';
      
      if (allTransactions.length === 0) {
        container.innerHTML = '<p>No transactions yet</p>';
        return;
      }
      
      allTransactions.forEach(transaction => {
        const transactionElement = document.createElement('div');
        transactionElement.className = 'last-expense-item';
        
        const date = new Date(transaction.date);
        const formattedDate = `${date.getDate()} ${monthNames[date.getMonth()].substring(0, 3)}`;
        
        transactionElement.innerHTML = `
          <div>
            <strong>${transaction.source}</strong><br>
            <small>${formattedDate} ‚Ä¢ ${transaction.notes || ''}</small>
          </div>
          <div class="${transaction.type}">
            ${transaction.type === 'income' ? '+' : '-'}Nu. ${parseFloat(transaction.amount).toFixed(2)}
          </div>
        `;
        
        container.appendChild(transactionElement);
      });
    }

    // Initialize the page
    function initPage() {
      initDarkMode();
      generateCalendar();
      
      const { incomeData, expenseData, totalIncome, totalExpense } = loadFinancialData();
      const balance = totalIncome - totalExpense;
      
      updateBalanceDisplay(balance);
      createLineChart(incomeData, expenseData);
      createDoughnutChart(totalIncome, totalExpense);
      displayRecentTransactions(incomeData, expenseData);
    }

    // Refresh data when page gains focus
    window.addEventListener('focus', initPage);

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initPage);
  </script>
</body>
</html>